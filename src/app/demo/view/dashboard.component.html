<div class="layout-dashboard">
    <div class="p-grid">
        <div class="p-col-12">
            <div class="notification">
                <h6>ðŸ‘‹ Hello! Welcome to Eazyvenue</h6>
            </div>
        </div>
    </div>

    <div class="p-grid" *ngIf="isAdmin">
        <div class="p-col-12">
            <div class="card">
                <h5>
                    <i class="pi pi-clock"></i>
                    Pending Venue Approvals
                    <span class="p-tag p-tag-warning" *ngIf="pendingVenues.length > 0">
                        {{ pendingVenues.length }}
                    </span>
                </h5>

                <div *ngIf="loading" class="p-text-center p-p-4">
                    <i class="pi pi-spin pi-spinner" style="font-size: 2rem"></i>
                    <p>Loading pending venues...</p>
                </div>

                <div *ngIf="!loading && pendingVenues.length === 0" class="p-text-center p-p-4">
                    <i class="pi pi-check-circle" style="font-size: 3rem; color: #4CAF50;"></i>
                    <h6>No pending approvals</h6>
                    <p class="p-text-secondary">All venues have been reviewed!</p>
                </div>

                <div *ngIf="!loading && pendingVenues.length > 0">
                    <p-dataView
                        [value]="pendingVenues"
                        layout="grid"
                        [paginator]="true"
                        [rows]="6"
                        [sortField]="'createdAt'"
                        [sortOrder]="-1">

                        <ng-template let-venue pTemplate="gridItem">
                            <div class="p-col-12 p-md-6 p-lg-4 p-mb-3">
                                <div class="venue-approval-card p-shadow-2 p-border-round">
                                    <div class="venue-approval-header p-p-3 p-pb-0">
                                        <div class="p-d-flex p-jc-between p-ai-center">
                                            <h6 class="p-m-0">{{ venue.name }}</h6>
                                            <span class="p-tag p-tag-warning">
                                                <i class="pi pi-clock p-mr-1"></i>
                                                Pending
                                            </span>
                                        </div>
                                        <small class="p-text-secondary">
                                            Submitted: {{ venue.createdAt | date:'medium' }}
                                        </small>
                                    </div>

                                    <div class="venue-approval-content p-p-3">
                                        <div class="p-mb-2">
                                            <strong>Owner:</strong> {{ venue.ownerfirstName }} {{ venue.ownerlastName }}
                                        </div>
                                        <div class="p-mb-2">
                                            <strong>Email:</strong> {{ venue.email }}
                                        </div>
                                        <div class="p-mb-2">
                                            <strong>Location:</strong> {{ venue.cityname }}, {{ venue.statename }}
                                        </div>
                                        <div class="p-mb-2">
                                            <strong>Capacity:</strong> {{ venue.capacity }} people
                                        </div>
                                        <div class="p-mb-3">
                                            <strong>Price:</strong> â‚¹{{ venue.venuePrice | number }}
                                        </div>
                                    </div>

                                    <div class="venue-approval-actions p-p-3 p-pt-0">
                                        <div class="p-d-flex p-jc-between p-ai-center">
                                            <p-button
                                                label="View Details"
                                                icon="pi pi-eye"
                                                class="p-button-text p-button-sm"
                                                (onClick)="viewVenueDetails(venue)">
                                            </p-button>

                                            <div class="p-d-flex p-ai-center">
                                                <p-button
                                                    label="Reject"
                                                    icon="pi pi-times"
                                                    class="p-button-danger p-button-sm p-mr-2"
                                                    (onClick)="rejectVenue(venue)">
                                                </p-button>

                                                <p-button
                                                    label="Approve"
                                                    icon="pi pi-check"
                                                    class="p-button-success p-button-sm"
                                                    (onClick)="approveVenue(venue)">
                                                </p-button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </ng-template>
                    </p-dataView>
                </div>
            </div>
        </div>
    </div>

    <!-- Dashboard Statistics - Only for Admins -->
    <div class="p-grid" *ngIf="isAdmin">
        <div class="p-col-12 p-md-6 p-lg-3">
            <div class="overview-box sales">
                <div class="overview-box-icon">
                    <i class="pi pi-building"></i>
                </div>
                <div class="overview-box-content">
                    <div class="overview-box-title">Total Venues</div>
                    <div class="overview-box-value" *ngIf="!dashboardLoading">{{ totalVenues }}</div>
                    <div class="overview-box-value" *ngIf="dashboardLoading">
                        <i class="pi pi-spin pi-spinner"></i>
                    </div>
                </div>
            </div>
        </div>

        <div class="p-col-12 p-md-6 p-lg-3">
            <div class="overview-box enquiries clickable" (click)="showEnquiriesDetails()">
                <div class="overview-box-icon">
                    <i class="pi pi-send"></i>
                </div>
                <div class="overview-box-content">
                    <div class="overview-box-title">Send Enquiries</div>
                    <div class="overview-box-value" *ngIf="!dashboardLoading">{{ sendEnquiries }}</div>
                    <div class="overview-box-value" *ngIf="dashboardLoading">
                        <i class="pi pi-spin pi-spinner"></i>
                    </div>
                </div>
                <div class="click-hint" *ngIf="sendEnquiries > 0">
                    <small>Click to view details</small>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Toast for notifications -->
<p-toast key="toastmsg"></p-toast>

<!-- Confirmation dialog -->
<p-confirmDialog
    [style]="{width: '450px'}"
    header="Confirmation"
    icon="pi pi-exclamation-triangle">
</p-confirmDialog>

<!-- Send Enquiries Modal -->
<p-dialog
    header="Send Enquiries Details"
    [(visible)]="showEnquiriesModal"
    [modal]="true"
    [style]="{width: '80vw', maxWidth: '1000px'}"
    [closable]="true"
    (onHide)="closeEnquiriesModal()">

    <div *ngIf="sendEnquiriesList.length === 0" class="p-text-center p-p-4">
        <i class="pi pi-info-circle" style="font-size: 3rem; color: #2196F3;"></i>
        <h6>No send enquiries found</h6>
        <p class="p-text-secondary">There are no send enquiries at the moment.</p>
    </div>

    <div *ngIf="sendEnquiriesList.length > 0">
        <p-dataView
            [value]="sendEnquiriesList"
            layout="list"
            [paginator]="true"
            [rows]="10">

            <ng-template let-enquiry pTemplate="listItem">
                <div class="enquiry-item p-p-3 p-mb-3 p-shadow-1 p-border-round">
                    <div class="p-d-flex p-jc-between p-ai-start">
                        <div class="enquiry-details">
                            <h6 class="p-m-0 p-mb-2">Enquiry ID: {{ enquiry._id || enquiry.id }}</h6>
                            <div class="p-mb-1">
                                <strong>Customer ID:</strong> {{ enquiry.customerId }}
                            </div>
                            <div class="p-mb-1">
                                <strong>Guest Count:</strong> {{ enquiry.guestcnt }}
                            </div>
                            <div class="p-mb-1">
                                <strong>Price:</strong> â‚¹{{ enquiry.price | number }}
                            </div>
                            <div class="p-mb-1">
                                <strong>Created:</strong> {{ enquiry.created_at | date:'medium' }}
                            </div>
                        </div>
                        <div class="enquiry-status">
                            <span class="p-tag p-tag-info">{{ enquiry.orderType }}</span>
                            <span class="p-tag p-tag-success p-ml-2" *ngIf="enquiry.status">Active</span>
                            <span class="p-tag p-tag-danger p-ml-2" *ngIf="!enquiry.status">Inactive</span>
                        </div>
                    </div>
                </div>
            </ng-template>
        </p-dataView>
    </div>
</p-dialog>


<style>
.venue-approval-card {
    background: white;
    border: 1px solid #e0e0e0;
    transition: all 0.3s ease;
}

.venue-approval-card:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(0,0,0,0.15) !important;
}

.venue-approval-header {
    border-bottom: 1px solid #f0f0f0;
}

.overview-box {
    background: white;
    padding: 1.5rem;
    border-radius: 8px;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    display: flex;
    align-items: center;
    margin-bottom: 1rem;
}

.overview-box-icon {
    width: 60px;
    height: 60px;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 50%;
    font-size: 1.5rem;
    margin-right: 1rem;
}

.sales .overview-box-icon {
    background: #e3f2fd;
    color: #1976d2;
}

.orders .overview-box-icon {
    background: #f3e5f5;
    color: #7b1fa2;
}

.users .overview-box-icon {
    background: #e8f5e8;
    color: #388e3c;
}

.revenue .overview-box-icon {
    background: #fff3e0;
    color: #f57c00;
}

.overview-box-title {
    font-size: 0.875rem;
    color: #666;
    margin-bottom: 0.5rem;
}

.overview-box-value {
    font-size: 1.5rem;
    font-weight: bold;
    color: #333;
}

.notification {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    padding: 1rem;
    border-radius: 8px;
    margin-bottom: 1rem;
}

.notification h6 {
    margin: 0;
    font-size: 1rem;
}

.enquiries .overview-box-icon {
    background: #e8f5e8;
    color: #388e3c;
}

.booknow .overview-box-icon {
    background: #e3f2fd;
    color: #1976d2;
}

.clickable {
    cursor: pointer;
    transition: transform 0.2s ease;
}

.clickable:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(0,0,0,0.15) !important;
}

.click-hint {
    text-align: center;
    margin-top: 0.5rem;
    color: #666;
}

.enquiry-item {
    background: white;
    border: 1px solid #e0e0e0;
}

.enquiry-details h6 {
    color: #333;
    font-weight: 600;
}

.enquiry-status {
    text-align: right;
}
</style>
