<div class="p-grid">
    <div class="p-col-12 banner-add-main-section">
      <div class="title-area">
        <h5 class="admin-heading">{{pagetitle}}</h5>
      </div>

      <div class="card p-pt-3">
        <p-toast key="toastmsg"></p-toast>

        <form [formGroup]="bannerForm">
          <!-- Basic Information Section -->
          <div class="form-section">
            <h6 class="section-title">Basic Information</h6>
            <div class="p-fluid p-formgrid p-grid pare_margin">

              <div class="p-field p-col-6">
                <label>Post Type<span class="mandatory-feilds">*</span></label>
                <p-dropdown [options]="postTypes" formControlName="post_type"
                            optionLabel="name" optionValue="value"
                            (onChange)="onPostTypeChange($event)"
                            placeholder="Select Post Type"
                            [ngClass]="{ 'is-invalid': submitted && f.post_type.errors }">
                </p-dropdown>
                <div *ngIf="submitted && f.post_type.errors" class="invalid-feedback">
                  <div *ngIf="f.post_type.errors.required">Post Type is required</div>
                </div>
              </div>

              <div class="p-field p-col-6">
                <label>Category<span class="mandatory-feilds">*</span></label>
                <p-dropdown [options]="categories" formControlName="category"
                            optionLabel="name" optionValue="value"
                            placeholder="Select Category"
                            [ngClass]="{ 'is-invalid': submitted && f.category.errors }">
                </p-dropdown>
                <div *ngIf="submitted && f.category.errors" class="invalid-feedback">
                  <div *ngIf="f.category.errors.required">Category is required</div>
                </div>
              </div>

              <div class="p-field p-col-8">
                <label>Post Title<span class="mandatory-feilds">*</span></label>
                <input id="banner_title" placeholder="Enter Post Title"
                       formControlName="banner_title" type="text" pInputText
                       (blur)="generateSlug()"
                       [ngClass]="{ 'is-invalid': submitted && f.banner_title.errors }">
                <div *ngIf="submitted && f.banner_title.errors" class="invalid-feedback">
                  <div *ngIf="f.banner_title.errors.required">Post Title is required</div>
                </div>
              </div>

              <div class="p-field p-col-4">
                <label>Slug<span class="mandatory-feilds">*</span></label>
                <input placeholder="post-slug" formControlName="slug" type="text" pInputText
                       [ngClass]="{ 'is-invalid': submitted && f.slug.errors }">
                <div *ngIf="submitted && f.slug.errors" class="invalid-feedback">
                  <div *ngIf="f.slug.errors.required">Slug is required</div>
                </div>
              </div>

              <div class="p-field p-col-6">
                <label>Author<span class="mandatory-feilds">*</span></label>
                <input placeholder="Author Name" formControlName="author" type="text" pInputText
                       [ngClass]="{ 'is-invalid': submitted && f.author.errors }">
              </div>

              <div class="p-field p-col-3">
                <label>Publish Date</label>
                <p-calendar formControlName="publish_date" dateFormat="dd/mm/yy"></p-calendar>
              </div>

              <div class="p-field p-col-1">
                <label class="mb-0">Published</label>
                <p-inputSwitch class="checkbox-mt-10 d-block" formControlName="is_published"></p-inputSwitch>
              </div>

              <div class="p-field p-col-1">
                <label class="mb-0">Status</label>
                <p-inputSwitch class="checkbox-mt-10 d-block" formControlName="status"></p-inputSwitch>
              </div>

              <!-- Content Editor - Fixed -->
              <div class="p-field p-col-12">
                <label>Content<span class="mandatory-feilds">*</span></label>
                <p-editor formControlName="banner_content"
                          (onTextChange)="calculateReadingTime()"
                          [style]="{'height':'200px'}"
                          [ngClass]="{ 'is-invalid': submitted && f.banner_content.errors }">
                  <ng-template pTemplate="header">
                    <span class="ql-formats">
                      <button class="ql-bold" aria-label="Bold"></button>
                      <button class="ql-italic" aria-label="Italic"></button>
                      <button class="ql-underline" aria-label="Underline"></button>
                      <button class="ql-list" value="ordered" aria-label="Ordered List"></button>
                      <button class="ql-list" value="bullet" aria-label="Unordered List"></button>
                      <button class="ql-link" aria-label="Link"></button>
                    </span>
                  </ng-template>
                </p-editor>
                <div class="p-field p-col-12">
                    <label>Content<span class="mandatory-feilds">*</span></label>
                    <textarea formControlName="banner_content"
                              (input)="calculateReadingTime()"
                              placeholder="Enter your content here..."
                              rows="8"
                              pInputTextarea
                              [ngClass]="{ 'is-invalid': submitted && f.banner_content.errors }">
                    </textarea>
                    <div *ngIf="submitted && f.banner_content.errors" class="invalid-feedback">
                      <div *ngIf="f.banner_content.errors.required">Content is required</div>
                    </div>
                  </div>
              </div>

              <!-- Reading Time Display - Fixed -->
              <div class="p-field p-col-3" *ngIf="bannerForm.get('reading_time')?.value">
                <label>Reading Time</label>
                <input [value]="bannerForm.get('reading_time')?.value" type="text" pInputText readonly>
              </div>

            </div>
          </div>

          <!-- Featured Post Settings -->
          <div class="form-section" *ngIf="bannerForm.get('post_type')?.value === 'featured'">
            <h6 class="section-title">Featured Post Settings</h6>
            <div class="p-fluid p-formgrid p-grid pare_margin">
              <div class="p-field p-col-3">
                <label>Featured Order<span class="mandatory-feilds">*</span></label>
                <p-inputNumber formControlName="featured_order" [min]="1" [max]="10"
                             [ngClass]="{ 'is-invalid': submitted && f.featured_order.errors }">
                </p-inputNumber>
                <small>Lower numbers appear first</small>
              </div>
            </div>
          </div>

          <!-- Instagram Post Settings -->
          <div class="form-section" *ngIf="bannerForm.get('post_type')?.value === 'instagram'">
            <h6 class="section-title">Instagram Settings</h6>
            <div class="p-fluid p-formgrid p-grid pare_margin">
              <div class="p-field p-col-6">
                <label>Instagram URL<span class="mandatory-feilds">*</span></label>
                <input placeholder="https://instagram.com/p/..." formControlName="instagram_url"
                       type="url" pInputText
                       [ngClass]="{ 'is-invalid': submitted && f.instagram_url.errors }">
                <div *ngIf="submitted && f.instagram_url.errors" class="invalid-feedback">
                  <div *ngIf="f.instagram_url.errors.required">Instagram URL is required</div>
                  <div *ngIf="f.instagram_url.errors.pattern">Please enter a valid URL</div>
                </div>
              </div>

              <div class="p-field p-col-2">
                <label class="mb-0">Is Video?</label>
                <p-inputSwitch class="checkbox-mt-10 d-block" formControlName="is_video"></p-inputSwitch>
              </div>

              <div class="p-field p-col-12">
                <label>Instagram Caption<span class="mandatory-feilds">*</span></label>
                <textarea formControlName="instagram_caption" pInputTextarea
                          placeholder="Instagram post caption..." rows="3"
                          [ngClass]="{ 'is-invalid': submitted && f.instagram_caption.errors }">
                </textarea>
              </div>
            </div>
          </div>

          <!-- Tags Section -->
          <div class="form-section">
            <h6 class="section-title">Tags</h6>
            <div class="p-fluid p-formgrid p-grid pare_margin">
              <div class="p-field p-col-12">
                <label>Available Tags</label>
                <div class="tag-buttons">
                  <p-button *ngFor="let tag of availableTags"
                            [label]="tag"
                            styleClass="p-button-outlined p-button-sm p-mr-2 p-mb-2"
                            (onClick)="addTag(tag)"
                            [disabled]="tags.includes(tag)">
                  </p-button>
                </div>
              </div>

              <div class="p-field p-col-12" *ngIf="tags.length > 0">
                <label>Selected Tags</label>
                <div class="selected-tags">
                  <p-chip *ngFor="let tag of tags; let i = index"
                          [label]="tag"
                          [removable]="true"
                          (onRemove)="removeTag(i)"
                          styleClass="p-mr-2 p-mb-2">
                  </p-chip>
                </div>
              </div>
            </div>
          </div>

          <!-- SEO Section -->
          <div class="form-section">
            <h6 class="section-title">SEO Settings</h6>
            <div class="p-fluid p-formgrid p-grid pare_margin">
              <div class="p-field p-col-8">
                <label>SEO Title</label>
                <input placeholder="SEO optimized title" formControlName="seo_title"
                       type="text" pInputText>
                <small>Leave empty to use post title</small>
              </div>

              <div class="p-field p-col-4">
                <label>SEO Keywords</label>
                <input placeholder="keyword1, keyword2, keyword3" formControlName="seo_keywords"
                       type="text" pInputText>
              </div>

              <div class="p-field p-col-12">
                <label>Meta Description</label>
                <textarea formControlName="meta_description" pInputTextarea
                          placeholder="Brief description for search engines..."
                          rows="2" maxlength="160">
                </textarea>
                <small>Leave empty to auto-generate from content (max 160 characters)</small>
              </div>
            </div>
          </div>

          <!-- Image Upload Section -->
          <div class="form-section">
            <h6 class="section-title">Images</h6>
            <div class="p-fluid p-formgrid p-grid pare_margin">
              <div class="p-field p-col-12">
                <label>Featured Image</label>
                <p-fileUpload multiple="multiple" chooseLabel="Upload Images"
                            accept="image/*" maxFileSize="10000000"
                            customUpload="true" (uploadHandler)="picUploader($event)">
                  <ng-template pTemplate="content">
                    <div class="banner-images"></div>
                  </ng-template>
                </p-fileUpload>
              </div>
            </div>
          </div>

          <!-- Action Buttons -->
          <div class="button-set p-col-12 d-flex p-fluid p-jc-md-end">
            <div class="p-formgrid p-grid">
              <button type="button" (click)="onSubmit()" pButton
                      icon="pi pi-check" label="Save & Publish"
                      class="p-button-success p-mr-2" style="width: auto">
              </button>

              <button pButton pRipple label="Save as Draft"
                      icon="pi pi-save" type="button"
                      (click)="onSubmit()"
                      style="width: auto" class="p-button-info p-mr-2">
              </button>

              <button pButton pRipple label="Reset"
                      icon="pi pi-refresh" type="reset"
                      (click)="onReset()"
                      style="width: auto" class="p-button-warning p-mr-2">
              </button>

              <button pButton pRipple type="button"
                      icon="pi pi-arrow-left" label="Back"
                      class="p-button-secondary"
                      (click)="backLink()" style="width: auto">
              </button>
            </div>
          </div>

          <input formControlName="disable" type="hidden" value="false">
        </form>
      </div>
    </div>
  </div>

  <style>
    .form-section {
      margin-bottom: 2rem;
      padding: 1rem;
      border: 1px solid #e9ecef;
      border-radius: 4px;
    }

    .section-title {
      color: #495057;
      font-weight: 600;
      margin-bottom: 1rem;
      padding-bottom: 0.5rem;
      border-bottom: 2px solid #007bff;
    }

    .tag-buttons .p-button {
      margin-right: 0.5rem;
      margin-bottom: 0.5rem;
    }

    .selected-tags {
      display: flex;
      flex-wrap: wrap;
      gap: 0.5rem;
    }

    .mandatory-feilds {
      color: #dc3545;
    }

    .invalid-feedback {
      display: block;
      width: 100%;
      margin-top: 0.25rem;
      font-size: 0.875em;
      color: #dc3545;
    }

    .is-invalid {
      border-color: #dc3545 !important;
    }
  </style>