<div class="card">
    <div class="card-header">
        <h4>Venue Enquiry Dashboard</h4>
    </div>
    <div class="card-body">
        <p-table
            [value]="enquiryList"
            [loading]="loading"
            [paginator]="true"
            [rows]="10"
            [totalRecords]="totalRecords"
            styleClass="p-datatable-customers">

            <ng-template pTemplate="header">
                <tr>
                    <th>Venue Name</th>
                    <th>Latest User</th>
                    <th>Contact No</th>
                    <th>No of Leads</th>
                    <th>Latest Date</th>
                    <th>Status</th>
                    <th>Actions</th>
                </tr>
            </ng-template>

            <ng-template pTemplate="body" let-enquiry>
                <tr>
                    <td>{{enquiry.venueName}}</td>
                    <td>{{enquiry.userName}}</td>
                    <td>{{enquiry.userContact}}</td>
                    <td>
                        <span class="badge badge-primary">{{enquiry.leadCount}}</span>
                    </td>
                    <td>{{enquiry.created_at | date:'dd/MM/yyyy HH:mm'}}</td>
                    <td>
                        <span
                            class="badge"
                            [ngClass]="{
                                'badge-success': enquiry.status === 'Contacted',
                                'badge-warning': enquiry.status === 'New',
                                'badge-info': enquiry.status === 'Converted',
                                'badge-secondary': enquiry.status === 'Closed'
                            }">
                            {{enquiry.status}}
                        </span>
                    </td>
                    <td>
                        <button
                            class="btn btn-sm btn-outline-success me-2"
                            (click)="updateStatus(enquiry, 'Contacted')"
                            [disabled]="enquiry.status === 'Contacted'">
                            Mark Contacted
                        </button>
                        <button
                            class="btn btn-sm btn-outline-info"
                            (click)="updateStatus(enquiry, 'Converted')"
                            [disabled]="enquiry.status === 'Converted'">
                            Mark Converted
                        </button>
                    </td>
                </tr>
            </ng-template>

            <ng-template pTemplate="emptymessage">
                <tr>
                    <td colspan="7">No enquiries found.</td>
                </tr>
            </ng-template>
        </p-table>
    </div>
</div>

<p-toast key="toastmsg"></p-toast>